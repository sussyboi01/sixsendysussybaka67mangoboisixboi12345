<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>hi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        margin:0;
        font-family:sans-serif;
        background:#14142b;
        color:white;
        padding:20px;
    }
    h1 {
        text-align:center;
        font-size:30px;
        text-shadow:0 0 15px #5a5aff;
    }
    #container {
        max-width:700px;
        margin:40px auto;
        background:#1a1a35;
        padding:25px;
        border-radius:12px;
        border:2px solid #252550;
        box-shadow:0 0 20px rgba(90,90,255,0.5);
    }
    .deviceItem {
        display:flex;
        align-items:center;
        justify-content:space-between;
        background:#14142b;
        padding:12px 15px;
        border-radius:10px;
        margin-bottom:10px;
        border:1px solid #252550;
    }
    .deviceItem span {
        font-family:monospace;
    }
    .removeBtn {
        background:#ff4a4a;
        border:none;
        padding:6px 10px;
        border-radius:8px;
        cursor:pointer;
        color:white;
        font-size:13px;
    }
    .removeBtn:hover { background:#ff6b6b; }

    #addBox {
        margin-top:25px;
        display:flex;
        flex-direction:column;
        gap:10px;
    }
    input, button {
        padding:12px;
        border-radius:10px;
        border:none;
        font-size:15px;
    }
    input {
        background:#0e0e24;
        color:white;
        border:1px solid #272755;
    }
    #addBtn {
        background:#5a5aff;
        color:white;
        cursor:pointer;
        font-weight:bold;
        text-shadow:0 0 10px rgba(255,255,255,0.3);
    }
    #addBtn:hover { background:#7878ff; }

    #deny {
        text-align:center;
        margin-top:50px;
        font-size:20px;
    }
</style>
</head>
<body>

<h1>Allowed Device Manager</h1>

<div id="deny" style="display:none;">
    ❌ Access Denied  
    <br><br>
    yeah okay buddy ur not getting in ur not slick <b>YOUR_GITHUB_USERNAME</b>.
</div>

<div id="container" style="display:none;">

    <h2>Allowed Devices</h2>
    <div id="list"></div>

    <div id="addBox">
        <input id="nickInput" placeholder="Device nickname e.g. Evan's PC">
        <input id="idInput" placeholder="Device ID (UUID)">
        <button id="addBtn">Add Device</button>
    </div>

</div>

<script>
// --------------------------
// SETTINGS
// --------------------------
const OWNER = "hexorod";   // <-- CHANGE THIS
const REPO = "sixsendysussybaka67mangoboisixboi12345";
const FILE_PATH = "allowed_ids.json";

// --------------------------
// STEP 1 — Verify GitHub login
// --------------------------

async function checkLogin() {
    const res = await fetch("https://api.github.com/user", {
        credentials: "include"
    });

    if (!res.ok) {
        document.getElementById("deny").style.display = "block";
        return false;
    }

    const data = await res.json();

    if (data.login !== OWNER) {
        document.getElementById("deny").style.display = "block";
        return false;
    }

    document.getElementById("container").style.display = "block";
    return true;
}

// --------------------------
// STEP 2 — Load IDs
// --------------------------

async function loadList() {
    const res = await fetch(`https://raw.githubusercontent.com/${OWNER}/${REPO}/main/${FILE_PATH}?t=${Date.now()}`);
    const json = await res.json();
    renderList(json);
}

function renderList(arr) {
    const list = document.getElementById("list");
    list.innerHTML = "";

    arr.forEach(item => {
        const div = document.createElement("div");
        div.className = "deviceItem";

        div.innerHTML = `
            <div>
                <b>${item.name}</b><br>
                <span>${item.id}</span>
            </div>
            <button class="removeBtn">X</button>
        `;

        div.querySelector("button").onclick = () => removeId(item.id);
        list.appendChild(div);
    });
}

// --------------------------
// STEP 3 — Add ID (via GitHub Issue)
// --------------------------

async function addId() {
    const name = document.getElementById("nickInput").value.trim();
    const id = document.getElementById("idInput").value.trim();

    if (!name || !id) return alert("Fill both fields.");

    await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/issues`, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            title: `ADD-ID: ${id}`,
            body: `nickname=${name}`
        })
    });

    alert("ID added! It will appear in ~5 seconds.");
}

document.getElementById("addBtn").onclick = addId;

// --------------------------
// STEP 4 — Remove ID (via GitHub Issue)
// --------------------------

async function removeId(id) {
    await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/issues`, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            title: `REMOVE-ID: ${id}`
        })
    });

    alert("ID removed! It will update shortly.");
}

// --------------------------
// INIT
// --------------------------
checkLogin().then(x => x && loadList());

</script>

</body>
</html>
