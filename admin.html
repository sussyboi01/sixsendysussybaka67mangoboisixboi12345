<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allowed Device Manager</title>
<style>
    body { margin:0; font-family:sans-serif; background:#14142b; color:white; padding:20px; }
    h1 { text-align:center; font-size:30px; text-shadow:0 0 15px #5a5aff; }
    #container { max-width:700px; margin:40px auto; background:#1a1a35; padding:25px; border-radius:12px; border:2px solid #252550; box-shadow:0 0 20px rgba(90,90,255,0.5); display:none; }
    .deviceItem { display:flex; align-items:center; justify-content:space-between; background:#14142b; padding:12px 15px; border-radius:10px; margin-bottom:10px; border:1px solid #252550; }
    .deviceItem span { font-family:monospace; }
    .removeBtn { background:#ff4a4a; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; color:white; font-size:13px; }
    .removeBtn:hover { background:#ff6b6b; }
    #addBox { margin-top:25px; display:flex; flex-direction:column; gap:10px; }
    input, button { padding:12px; border-radius:10px; border:none; font-size:15px; }
    input { background:#0e0e24; color:white; border:1px solid #272755; }
    #addBtn { background:#5a5aff; color:white; cursor:pointer; font-weight:bold; text-shadow:0 0 10px rgba(255,255,255,0.3); }
    #addBtn:hover { background:#7878ff; }
    #deny { text-align:center; margin-top:50px; font-size:20px; display:none; }
</style>
</head>
<body>

<h1>Allowed Device Manager</h1>

<div id="deny">
    ❌ Access Denied  
    <br><br>
    wrong password lil bro
</div>

<div id="container">
    <h2>Allowed Devices</h2>
    <div id="list"></div>

    <div id="addBox">
        <input id="nickInput" placeholder="Device nickname (example: Evan's PC)">
        <input id="idInput" placeholder="Device ID (UUID)">
        <button id="addBtn">Add Device</button>
    </div>
</div>

<script>
const PASSWORD = "eaterevan123";
const entered = prompt("Enter admin password:");
if (entered !== PASSWORD) {
    document.getElementById("deny").style.display = "block";
    throw new Error("Incorrect password — stopping script.");
}
document.getElementById("container").style.display = "block";

// Cloudflare Worker URL
const WORKER_URL = "https://hiboi.hexorod0.workers.dev";

// -----------------------------
// LOAD DEVICE LIST
// -----------------------------
async function loadList() {
    try {
        const res = await fetch(`${WORKER_URL}/devices`);
        if (!res.ok) throw new Error("Failed to fetch device list");
        const data = await res.json();
        renderList(data);
    } catch (err) {
        alert("Failed to load devices.");
        console.error(err);
    }
}

function renderList(devices) {
    const list = document.getElementById("list");
    list.innerHTML = "";
    devices.forEach(d => {
        const div = document.createElement("div");
        div.className = "deviceItem";
        div.innerHTML = `
            <div><b>${d.name}</b><br><span>${d.id}</span></div>
            <button class="removeBtn">X</button>
        `;
        div.querySelector("button").onclick = () => removeDevice(d.id);
        list.appendChild(div);
    });
}

// -----------------------------
// ADD DEVICE
// -----------------------------
async function addDevice() {
    const name = document.getElementById("nickInput").value.trim();
    const id = document.getElementById("idInput").value.trim();
    if (!name || !id) return alert("Fill both fields!");

    try {
        const res = await fetch(`${WORKER_URL}/devices`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, id })
        });
        if (!res.ok) throw new Error("Failed to add device");
        document.getElementById("nickInput").value = "";
        document.getElementById("idInput").value = "";
        loadList();
    } catch (err) {
        alert("Failed to add device");
        console.error(err);
    }
}

document.getElementById("addBtn").onclick = addDevice;

// -----------------------------
// REMOVE DEVICE
// -----------------------------
async function removeDevice(id) {
    if (!confirm("Remove this device?")) return;
    try {
        const res = await fetch(`${WORKER_URL}/devices`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id })
        });
        if (!res.ok) throw new Error("Failed to remove device");
        loadList();
    } catch (err) {
        alert("Failed to remove device");
        console.error(err);
    }
}

// INIT
loadList();
</script>
</body>
</html>
