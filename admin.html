<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Allowed Device Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { 
    margin:0; 
    font-family:sans-serif; 
    background:#14142b; 
    color:white; 
    overflow:hidden; 
    display:flex; 
    justify-content:center; 
    align-items:flex-start; 
    padding-top:50px;
    min-height:100vh;
  }
  .sidebar { 
    width:400px; 
    background:#1a1a35; 
    padding:30px 20px; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    border-radius:12px;
    border:2px solid #252550;
    box-shadow:0 0 20px rgba(90,90,255,0.5);
  }
  .sidebar h1 { 
    font-size:28px; 
    margin-bottom:20px; 
    text-shadow:0 0 15px #5a5aff; 
    text-align:center;
  }
  .deviceItem {
    display:flex;
    align-items:center;
    justify-content:space-between;
    background:#14142b;
    padding:12px 15px;
    border-radius:10px;
    margin-bottom:10px;
    border:1px solid #252550;
    width:100%;
  }
  .deviceItem span { font-family:monospace; }
  .removeBtn {
    background:#ff4a4a;
    border:none;
    padding:6px 10px;
    border-radius:8px;
    cursor:pointer;
    color:white;
    font-size:13px;
  }
  .removeBtn:hover { background:#ff6b6b; }
  #addBox { margin-top:20px; display:flex; flex-direction:column; gap:10px; width:100%; }
  input, button { padding:12px; border-radius:10px; border:none; font-size:15px; width:100%; }
  input { background:#0e0e24; color:white; border:1px solid #272755; }
  #addBtn { background:#5a5aff; color:white; cursor:pointer; font-weight:bold; text-shadow:0 0 10px rgba(255,255,255,0.3); }
  #addBtn:hover { background:#7878ff; }
</style>
</head>
<body>

<div class="sidebar">
    <h1>Allowed Device Manager</h1>
    <div id="list"></div>
    <div id="addBox">
        <input id="nickInput" placeholder="Device nickname e.g. Evan's PC">
        <input id="idInput" placeholder="Device ID (UUID)">
        <button id="addBtn">Add Device</button>
    </div>
</div>

<script>
const WORKER_URL = './manage-ids.yml'; // same repo worker
let allowedIDs = [];

// ----------------------
// Fetch allowed IDs
// ----------------------
async function loadList() {
    try {
        const res = await fetch(WORKER_URL);
        const json = await res.json();
        allowedIDs = json;
        renderList();
    } catch(e) {
        alert('Failed to fetch allowed IDs from worker.');
        console.error(e);
    }
}

function renderList() {
    const list = document.getElementById('list');
    list.innerHTML = '';
    allowedIDs.forEach(item => {
        const div = document.createElement('div');
        div.className = 'deviceItem';
        div.innerHTML = `
            <div>
                <b>${item.name}</b><br>
                <span>${item.id}</span>
            </div>
            <button class="removeBtn">X</button>
        `;
        div.querySelector('button').onclick = () => removeID(item.id);
        list.appendChild(div);
    });
}

// ----------------------
// Add / Remove IDs
// ----------------------
async function addID() {
    const name = document.getElementById('nickInput').value.trim();
    const id = document.getElementById('idInput').value.trim();
    if(!name || !id) return alert('Fill both fields');

    try {
        await fetch(WORKER_URL, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({action:'add', name, id})
        });
        alert('ID added!');
        loadList();
    } catch(e) { console.error(e); alert('Failed to add ID'); }
}

async function removeID(id) {
    try {
        await fetch(WORKER_URL, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({action:'remove', id})
        });
        alert('ID removed!');
        loadList();
    } catch(e) { console.error(e); alert('Failed to remove ID'); }
}

document.getElementById('addBtn').addEventListener('click', addID);

// ----------------------
// INIT
// ----------------------
loadList();
</script>

</body>
</html>
